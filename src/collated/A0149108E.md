# A0149108E
###### \controller\AddOperation.java
``` java
 *
 */
import model.TodoFile;
import model.TodoItem;


public class AddOperation extends Operation {
	private TodoItem addedItem;

	public AddOperation(TodoFile t, TodoItem i) {
		super(t);
		addedItem = i;
	}

	@Override
	public void execute() {
		super.todos.add(this.addedItem);
	}

	@Override
	public void inverse() {
		super.todos.delete(this.addedItem);
	}

}
```
###### \controller\ChangeStatusOperation.java
``` java
 */
import model.TodoFile;
import model.TodoItem;


public class ChangeStatusOperation extends Operation {
	TodoItem item;

	public ChangeStatusOperation(TodoFile t, TodoItem i) {
		super(t);
		item = i;
	}

	@Override
	public void execute() {
		todos.toggle(item);
	}

	@Override
	public void inverse() {
		todos.toggle(item);
	}

}
```
###### \controller\ChangeStatusOperationTest.java
``` java
 */

import static org.junit.Assert.*;

import org.junit.Before;
import org.junit.Test;

import model.TodoItem;

public class ChangeStatusOperationTest extends OperationTest {
	ChangeStatusOperation op;

	/*
	 * (non-Javadoc)
	 * 
	 * @see controller.OperationTest#setUp()
	 */
	@Before
	public void setUp() {
		super.setUp();
		op = new ChangeStatusOperation(todos, item);
	}

	/**
	 * Test method for {@link controller.ChangeStatusOperation#execute()}.
	 */
	@Test
	@Override
	public void testExecute() {
		op.execute();
		assertTrue(item.getStatus() == TodoItem.Status.DONE);
		op.execute();
		assertTrue(item.getStatus() == TodoItem.Status.TODO);
	}

	/**
	 * Test method for {@link controller.ChangeStatusOperation#inverse()}.
	 */
	@Test
	@Override
	public void testInverse() {
		op.execute();
		assertTrue(item.getStatus() == TodoItem.Status.DONE);
		op.inverse();
		assertTrue(item.getStatus() == TodoItem.Status.TODO);
	}

}
```
###### \controller\CommandInterpreter.java
``` java
	 */
	public void nextCommand(String text) {
		lastCommand = text;
	}
	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void toggleHorizontalWrap() {
		if (scroll.getHbarPolicy() == ScrollBarPolicy.AS_NEEDED) {
			scroll.setHbarPolicy(ScrollBarPolicy.NEVER);
		} else {
			scroll.setHbarPolicy(ScrollBarPolicy.AS_NEEDED);
		}
		flexiView.refresh();
	}

	/**
	 * @param command the directory to change to
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void changeDirectory(String command) {
		Operation op;
		String rest = getRest(command).trim();
		op = new ChangeDirectoryOperation(todos, rest, this);
		op.execute();
		undos.add(op);
		flexiView.refresh();
	}

	/**
	 * @param command time to change it to
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void changeTime(String command) {
		String newTime = lastCommand.substring(command.length()).trim();
		switch (newTime.toLowerCase()) {
		case "help":
			System.out.println("Possible intervals are day, week, month, all, future");
			break;
		case "day":
			flexiView.setTimeState(FlexiArea.TimeState.DAY);
			System.out.println("Set time interval to day");
			break;
		case "week":
			flexiView.setTimeState(FlexiArea.TimeState.WEEK);
			System.out.println("Set time interval to week");
			break;
		case "month":
			flexiView.setTimeState(FlexiArea.TimeState.MONTH);
			System.out.println("Set time interval to month");
			break;
		case "all":
			flexiView.setTimeState(FlexiArea.TimeState.ALL);
			System.out.println("Set time interval to all");
			break;
		case "future":
			flexiView.setTimeState(FlexiArea.TimeState.FUTURE);
			System.out.println("Set time interval to future");
			break;
		case "float":
		case "floating":
			flexiView.setTimeState(FlexiArea.TimeState.FLOATING);
			System.out.println("Set time interval to floating");
			break;
		default:
			System.out.println("Time chunk not recognized.");
			break;
		}
	}

	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void displayTime() {
		switch (flexiView.getTimeState()) {
		case ALL:
			System.out.println("The current time mode is All.");
			break;
		case DAY:
			System.out.println("The current time mode is day from " + flexiView.startString() + " to " + flexiView.endString());
			break;
		case FUTURE:
			System.out.println("The current time mode is future from " + flexiView.startString() + " onwards.");
			break;
		case MONTH:
			System.out
					.println("The current time mode is month from " + flexiView.startString() + " to " + flexiView.endString());
			break;
		case WEEK:
			System.out
					.println("The current time mode is week from " + flexiView.startString() + " to " + flexiView.endString());
			break;
		case FLOATING:
			System.out.println("The current time mode is Floating.");
			break;
		default:
			break;
		}
	}

	/**
	 * @param command what mode to change to
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void changeMode(String command) {
		String newMode = lastCommand.substring(command.length()).trim();
		switch (newMode.toLowerCase()) {
		case "help":
			System.out.println("The possible modes are date, priority, status, contents, and heat.");
			break;
		case "date":
		case "duedate":
			flexiView.setMode(FlexiArea.Mode.SORT_DUE_DATE);
			break;
		case "startdate":
			flexiView.setMode(FlexiArea.Mode.SORT_START_DATE);
			break;
		case "priority":
			flexiView.setMode(FlexiArea.Mode.SORT_PRIORITY);
			break;
		case "status":
			flexiView.setMode(FlexiArea.Mode.SORT_STATUS);
			break;
		case "contents":
			flexiView.setMode(FlexiArea.Mode.SORT_CONTENTS);
			break;
		default:
			System.out.println("Mode not recognized.");
			break;
		}
	}

	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void displayMode() {
		switch (flexiView.getMode()) {
		case SORT_CONTENTS:
			System.out.println("The current mode is Sort Contents.");
			break;
		case SORT_DUE_DATE:
			System.out.println("The current mode is Sort Due Date.");
			break;
		case SORT_START_DATE:
			System.out.println("The current mode is Sort Start Date.");
			break;
		case SORT_PRIORITY:
			System.out.println("The current mode is Sort Priority.");
			break;
		case SORT_STATUS:
			System.out.println("The current mode is Sort Status.");
			break;
		default:
			break;
		}
	}

	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void toggleEcho() {
		echoing = !echoing;
		if (echoing) {
			System.out.println("Echoing user commands.");
		} else {
			System.out.println("Not echoing user commands.");
		}
	}

	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void clear() {
		System.out.println("Clearing the TodoFile cannot be undone. Please input 'yes' to confirm operation.");
		confirming = true;
	}

	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void confirm() {
		if (confirming) {
			todos.clear();
			confirming = false;
			System.out.println("all todos deleted");
			flexiView.refresh();
		}
	}



	/**
	 * @param splitString The split version of the comman
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void delete(String[] splitString) {
		Operation op;
		if (todos.isEmpty()) {
			System.out.printf("No todos\n");
			return;
		}
		int index;
		if (splitString.length < 2) {
			System.out.println("No number supplied, deleting first element.");
			index = 1;
		} else {
			try {
				index = Integer.parseInt(splitString[1]);
			} catch (NumberFormatException e) {
				System.out.print("Parameter must be a number\n");
				return;
			}
		}
		op = new DeleteOperation(todos, flexiView.getTodoItem(index - 1));
		op.execute();
		undos.add(op);
		flexiView.refresh();
	}

	
	/**
```
###### \controller\CommandInterpreter.java
``` java
	 */
	private void display() {
		Operation op;
		op = new DisplayOperation(todos);
		op.execute();
		undos.add(op);
	}
	/**
```
###### \controller\DeleteOperation.java
``` java
 */
import model.TodoFile;
import model.TodoItem;

public class DeleteOperation extends Operation {
	private TodoItem deletedItem;

	public DeleteOperation(TodoFile t, TodoItem deletedItem) {
		super(t);
		this.deletedItem = deletedItem;
	}

	@Override
	public void execute() {
		super.todos.delete(this.deletedItem);
	}

	@Override
	public void inverse() {
		super.todos.add(this.deletedItem);
	}

}
```
###### \controller\DeleteOperationTest.java
``` java
 */
import org.junit.Before;
import org.junit.Test;

public class DeleteOperationTest extends OperationTest {
	DeleteOperation op;
	AddOperation invOp;

	@Before
	public void setUp() {
		super.setUp();
		op = new DeleteOperation(this.todos, this.item);
		invOp = new AddOperation(this.todos, this.item);
	}

	@Test
	public void testAddInverse() {
		invOp.execute();
		hasAsFirstElement();
		op.execute();
		isEmptyTodos();
	}

	@Test
	@Override
	public void testExecute() {
		this.todos.add(this.item);
		hasAsFirstElement();
		op.execute();
		isEmptyTodos();
	}

	@Test
	@Override
	public void testInverse() {
		op.inverse();
		hasAsFirstElement();
		op.execute();
		isEmptyTodos();
	}

}
```
###### \controller\DisplayOperation.java
``` java
 */
import model.TodoFile;

public class DisplayOperation extends Operation {
	public DisplayOperation(TodoFile t) {
		super(t);
	}

	@Override
	public void execute() {
		this.todos.display();
	}

	@Override
	public void inverse() {
	}

}
```
###### \controller\FixedSizeStack.java
``` java
 */
import java.util.LinkedList;

public class FixedSizeStack<T> extends LinkedList<T> {
	private static final long serialVersionUID = 1L;
	private int maxSize;
	private int numElements;

	public FixedSizeStack(int size) {
		super();
		numElements = 0;
		this.maxSize = size;
	}

	@Override
	public void push(T item) {
		if (this.numElements == this.maxSize) {
			super.removeLast();
		} else {
			this.numElements++;
		}
		super.addFirst(item);
	}
}
```
###### \controller\FixedSizeStackTest.java
``` java
 */
import org.junit.Before;
import org.junit.Test;

public class FixedSizeStackTest {
	public static final int SIZE = 500000;
	FixedSizeStack<Integer> emptyStack;
	FixedSizeStack<Integer> fullStack;

	@Before
	public void setUp() {
		fullStack = new FixedSizeStack<Integer>(SIZE);
		for (int i = 0; i < SIZE; i++) {
			fullStack.push(i);
		}
		emptyStack = new FixedSizeStack<Integer>(SIZE);
	}

	@Test
	public void testDrop() {
		fullStack.push(SIZE);
		assertEquals(fullStack.getLast().intValue(), 1);
	}

	@Test
	public void testAdd() {
		emptyStack.push(SIZE);
		assertEquals(emptyStack.getFirst().intValue(), SIZE);
		fullStack.push(SIZE);
		assertEquals(fullStack.getFirst().intValue(), SIZE);
	}

}
```
###### \controller\Operation.java
``` java
 */
import model.TodoFile;

/**
 * The operation class is an abstraction over transactions on the todo file
 * classes need to implement execute and inverse, which should result in the
 * same todo file.
 * 
 * @param t todofile on which the operations are being performed.
 */
public abstract class Operation {
	protected TodoFile todos;

	public Operation(TodoFile t) {
		todos = t;
	}

	public abstract void execute();

	public abstract void inverse();
}
```
###### \controller\OperationTest.java
``` java
 */
import static org.junit.Assert.assertEquals;

import java.io.File;

import org.junit.Before;

import model.TodoFile;
import model.TodoItem;
import model.TodoItem.Frequency;

public abstract class OperationTest {
	public static final String TESTNAME = "tester.txt";
	TodoFile todos;
	TodoItem item;

	@Before
	public void setUp() {
		File file = new File(TESTNAME);
		if (file.exists()) {
			file.delete();
		}
		todos = new TodoFile(TESTNAME);
		item = new TodoItem(TodoItem.Status.TODO, -1, null, null, "This is a test add.", Frequency.NONE);
	}

	protected void hasAsFirstElement() {
		assertEquals(this.todos.getItem(0), this.item);
	}

	protected void isEmptyTodos() {
		assertEquals(this.todos.isEmpty(), true);
	}

	public abstract void testExecute();

	public abstract void testInverse();
}
```
###### \controller\Undoer.java
``` java
 *
 */
public class Undoer {
	public static final int MAX_UNDO = 50;
	private FixedSizeStack<Operation> operations;

	public Undoer() {
		operations = new FixedSizeStack<Operation>(MAX_UNDO);
	}

	public void add(Operation op) {
		assert op != null;
		operations.push(op);
	}

	public void undo() {
		if (operations.size() > 0)
			operations.pop().inverse();
	}
}
```
###### \controller\UndoerTest.java
``` java
 */
import org.junit.Before;
import org.junit.Test;

public class UndoerTest extends OperationTest {
	Undoer u;

	@Before
	public void setUp() {
		super.setUp();
		u = new Undoer();
	}

	@Test
	public void testUndoAdd() {
		AddOperation op = new AddOperation(this.todos, this.item);
		op.execute();
		u.add(op);
		hasAsFirstElement();
		u.undo();
		isEmptyTodos();
	}

	@Test
	public void testUndoDelete() {
		this.todos.add(this.item);
		DeleteOperation op = new DeleteOperation(this.todos, this.item);
		op.execute();
		u.add(op);
		isEmptyTodos();
		u.undo();
		hasAsFirstElement();
	}

	@Override
	public void testExecute() {
	}

	@Override
	public void testInverse() {
	}

}
```
###### \model\TodoFile.java
``` java
	 */
	public TodoFile(String fileName) {
		this.fileName = fileName;
		this.lines = 1;
		this.todos = new ArrayList<TodoItem>();
		if (new File(fileName).exists()) {
			readTodos(fileName);
		}
		updateRecur();
	}

	/**
	 * @param path the path to the todo file
```
###### \model\TodoFile.java
``` java
	 */
	private TodoItem parseTodo(String todo) {
		String[] parts = todo.split(SPLITTER);
		if (parts.length < 6) {
			System.err.println(todo);
			System.err.println(parts[2]);
			System.err.println(parts.length);
			error("Wrong number of sections", lines);
		}
		// status,prior,start,due,freq,content
		TodoItem.Status s = todoStatusParsing(parts);
		int p = todoPriorityParsing(parts);
		Date sD = todoStartDateParsing(parts);
		Date dD = todoEndDateParsing(parts);
		Frequency f = todoFrequencyParsing(parts);
		String c = todoContentParsing(parts);
		return new TodoItem(s, p, sD, dD, c, f);
	}

	private String todoContentParsing(String[] parts) {
		String c = "";
		for (int i = 5; i < parts.length; i++) {
			if (i == 5) {
				c += parts[i];
			} else {
				c += ("|" + parts[i]);
			}
		}
		return c;
	}

	private Frequency todoFrequencyParsing(String[] parts) {
		Frequency f = null;
		if (parts[4].equals("")) {
			f = Frequency.NONE;
		} else if (parts[4].equals("DAILY")) {
			f = Frequency.DAILY;
		} else if (parts[4].equals("WEEKLY")) {
			f = Frequency.WEEKLY;
		} else if (parts[4].equals("MONTHLY")) {
			f = Frequency.MONTHLY;
		} else if (parts[4].equals("YEARLY")) {
			f = Frequency.YEARLY;
		} else {
			System.out.println(parts[4]);
			error("Error parsing frequency", lines);
		}
		return f;
	}

	private Date todoEndDateParsing(String[] parts) {
		Date dD = null;
		try {
			dD = parts[3].isEmpty() ? null : (Date) FORMATTER.parse(parts[3]);
		} catch (ParseException e) {
			e.printStackTrace();
			error("Error parsing due date", lines);
		}
		return dD;
	}

	private Date todoStartDateParsing(String[] parts) {
		Date sD = null;
		try {
			sD = parts[2].isEmpty() ? null : (Date) FORMATTER.parse(parts[2]);
		} catch (ParseException e) {
			e.printStackTrace();
			error("Error parsing start date", lines);
		}
		return sD;
	}

	private int todoPriorityParsing(String[] parts) {
		int p = -1;
		try {
			p = parts[1].isEmpty() ? -1 : Integer.parseInt(parts[1]);
		} catch (Exception e) {
			error("Priority is not a valid int", lines);
		}
		return p;
	}

	private TodoItem.Status todoStatusParsing(String[] parts) {
		TodoItem.Status s = null;
		if (parts[0].equals("TODO")) {
			s = TodoItem.Status.TODO;
		} else if (parts[0].equals("DONE")) {
			s = TodoItem.Status.DONE;
		} else {
			error("Status: " + parts[0] + " is incorrect format", lines);
		}
		return s;
	}

	/**
	 * @param msg error message
	 * @param l line number
```
###### \model\TodoFile.java
``` java
	 */
	private void error(String msg, int l) {
		System.err.print(msg + " at line " + l);
		System.exit(1);
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void delete(TodoItem t) {
		try {
			todos.remove(t);
			System.out.printf("deleted from %s: \"%s\"\n", fileName, t.toString());
		} catch (Exception e) {
			System.out.printf(t.toString() + " is not found in todos.");
		}
		todos.remove(t);
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void display() {
		if (this.isEmpty()) {
			System.out.println(fileName + " is empty");
			return;
		}
		printFile();
	}


	/**
	 * Adds a TodoItem to the <tt>todos</tt> List with the parameter,
	 * <tt>message</tt>, as the content.
	 * 
	 * @param message
	 *            that the user wants to store
```
###### \model\TodoFile.java
``` java
	 */
	public void add(String message) {
		todos.add(new TodoItem(TodoItem.Status.TODO, -1, null, null, message, Frequency.NONE));
		System.out.printf("added to %s: \"%s\"\n", fileName, message);
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public TodoItem getItem(int i) {
		return this.todos.get(i);
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	private void printLine(int location) {
		System.out.printf("%d. %s\n", location, todos.get(location - 1));
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public boolean isEmpty() {
		return this.todos.isEmpty();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void write() {
		try {
			this.writer = new PrintWriter(new FileWriter(fileName, false));
		} catch (IOException e) {
			e.printStackTrace();
		}
		for (int i = 0; i < todos.size(); i++) {
			writer.println(todos.get(i));
		}
		writer.flush();
		writer.close();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void clear() {
		todos.clear();
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void exit() {
		write();
		writer.close();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sort() {
		Collections.sort(todos, TodoItem.getDueDateComparator());
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sortByDueDate() {
		Collections.sort(todos, TodoItem.getDueDateComparator());
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sortByStartDate() {
		Collections.sort(todos, TodoItem.getStartDateComparator());
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sortByPriority() {
		Collections.sort(todos, TodoItem.getPriorityComparator());
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sortByStatus() {
		Collections.sort(todos, TodoItem.getStatusComparator().reversed());
		write();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public void sortByContents() {
		Collections.sort(todos, TodoItem.getContentsComparator());
		write();
	}

	/**
	 * returns a list of todo items with due dates between begin and end
```
###### \model\TodoFile.java
``` java
	 */
	public List<TodoItem> filterDueDates(LocalDateTime begin, LocalDateTime end) {
		List<TodoItem> ret = new ArrayList<TodoItem>();
		for (TodoItem todo : todos) {
			if (todo.getDueDate() == null)
				continue;
			Instant i = Instant.ofEpochMilli(todo.getDueDate().getTime());
			LocalDateTime comp = LocalDateTime.ofInstant(i, ZoneOffset.UTC);
			if ((begin.isBefore(comp) || begin.isEqual(comp)) && (end.isAfter(comp) || end.isEqual(comp))) {
				ret.add(todo);
			}
		}
		return ret;
	}

	/**
	 * returns a list of todo items with start dates between begin and end
```
###### \model\TodoFile.java
``` java
	 */
	public List<TodoItem> filterStartDates(LocalDateTime begin, LocalDateTime end) {
		List<TodoItem> ret = new ArrayList<TodoItem>();
		for (TodoItem todo : todos) {
			// TODO the type stored in the TodoItem class to LocalDateTime
			// TODO remove jada, as java8.time is supersedes it.
			if (todo.getStartDate() == null)
				continue;
			Instant i = Instant.ofEpochMilli(todo.getStartDate().getTime());
			LocalDateTime comp = LocalDateTime.ofInstant(i, ZoneOffset.UTC);
			if ((begin.isBefore(comp) || begin.isEqual(comp)) && (end.isAfter(comp) || end.isEqual(comp))) {
				ret.add(todo);
			}
		}
		return ret;
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public String toString() {
		StringBuilder ret = new StringBuilder();
		for (TodoItem item : todos) {
			ret.append(item.toString());
			ret.append("\n");
		}
		return ret.toString();
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public List<TodoItem> filterFloatingTodos() {
		List<TodoItem> ret = new ArrayList<TodoItem>();
		for (TodoItem todo : todos) {
			if (todo.getStartDate() == null && todo.getDueDate() == null) {
				ret.add(todo);
			}
		}
		return ret;
	}

	/**
```
###### \model\TodoFile.java
``` java
	 */
	public String getFileName() {
		return this.fileName;
	}
}
```
###### \model\TodoItem.java
``` java
	 */
	public enum Status {
		TODO, DONE
	};

	/**
```
###### \model\TodoItem.java
``` java
	 */
	private Status status;
	/**
```
###### \model\TodoItem.java
``` java
	 */
	private Date dueDate; // possibly null
	/**
```
###### \model\TodoItem.java
``` java
	 */
	private String contents;

	/**
```
###### \model\TodoItem.java
``` java
	 */
	public TodoItem(String contents) {
		this.status = Status.TODO;
		this.priority = -1;
		this.startDate = null;
		this.dueDate = null;
		this.contents = contents;
		this.freq = Frequency.NONE;
	}
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public String toString() {
		String todo = "";
		todo += getStatus() + "|";
		todo += (getPriority() == -1 ? "" : getPriority()) + "|";
		todo += (getStartDate() != null ? getStartDate().toString() : "") + "|";
		todo += (getDueDate() != null ? getDueDate().toString() : "") + "|";
		todo += (getFreq() == Frequency.NONE ? "" : getFreq()) + "|";
		todo += getContents();
		return todo;
	}

	/*
	 *Comparators 
	 */
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public static Comparator<TodoItem> getDueDateComparator() {
		return new Comparator<TodoItem>() {
			public int compare(TodoItem i, TodoItem j) {
				if (i.getDueDate() == null || j.getDueDate() == null)
					return 0;
				return i.getDueDate().compareTo(j.getDueDate());
			}
		};
	}
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public static Comparator<TodoItem> getStartDateComparator() {
		return new Comparator<TodoItem>() {
			public int compare(TodoItem i, TodoItem j) {
				if (i.getStartDate() == null || j.getStartDate() == null)
					return 0;
				return i.getStartDate().compareTo(j.getStartDate());
			}
		};
	}
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public static Comparator<TodoItem> getPriorityComparator() {
		return new Comparator<TodoItem>() {
			public int compare(TodoItem i, TodoItem j) {
				return Integer.compare(i.getPriority(), j.getPriority());
			}
		};
	}
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public static Comparator<TodoItem> getStatusComparator() {
		return new Comparator<TodoItem>() {
			public int compare(TodoItem i, TodoItem j) {
				if (i.getStatus() == Status.TODO) {
					if (j.getStatus() == Status.TODO) {
						return 0;
					}
					return -1;
				} else {
					if (j.getStatus() == Status.TODO) {
						return 1;
					}
					return 0;
				}
			}
		};
	}
	/**
```
###### \model\TodoItem.java
``` java
	 */
	public static Comparator<TodoItem> getContentsComparator() {
		return new Comparator<TodoItem>() {
			public int compare(TodoItem i, TodoItem j) {
				return i.getContents().compareTo(j.getContents());
			}
		};
	}
	
	/**
```
###### \view\ConsoleArea.java
``` java
 */
import java.io.IOException;
import java.io.OutputStream;

import javafx.scene.control.TextArea;

public class ConsoleArea extends OutputStream {
	private TextArea out;

	public ConsoleArea(TextArea out) {
		this.out = out;
	}

	@Override
	public void write(int b) throws IOException {
		out.appendText(String.valueOf((char) b));
	}

}
```
###### \view\FlexiArea.java
``` java
 */
import javafx.scene.paint.Color;
import javafx.scene.text.Font;
import javafx.scene.text.Text;
import javafx.scene.text.TextFlow;
import model.TodoFile;
import model.TodoItem;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;
import java.time.Duration;
import java.time.Instant;
import java.time.temporal.TemporalAdjusters;
import java.time.temporal.WeekFields;
import java.util.Locale;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Date;

public class FlexiArea extends TextFlow {
	public static final Mode DEFAULT_MODE = Mode.SORT_START_DATE;
	public static final TimeState DEFAULT_TIME = TimeState.ALL;
	public static int padSize = 54;
	public static int floatingSize = 15;
	private TodoFile todos;
	private Mode mode = DEFAULT_MODE;
	private TimeState timeState;
	private LocalDateTime start, end; // null when floating
	private List<GuiTodo> currTodos;
	private boolean doneLast;

	public enum Mode {
		/*
		 * SORT_DATE: Show the due dates SORT_PRIORITY: Sort by priority
		 * SORT_STATUS: Sort by status SORT_CONTENTS: Sort by contents HEAT_MAP:
		 * show the heat map
		 */
		SORT_START_DATE, SORT_DUE_DATE, SORT_PRIORITY, SORT_STATUS, SORT_CONTENTS
	};

	public enum TimeState {
		/*
		 * This is the chunk of time shown. DAY: view each day WEEK: view each
		 * week MONTH: view each month ALL: everything, in a big bag FUTURE:
		 * everything in the future, in a big bag
		 */
		DAY, WEEK, MONTH, ALL, FUTURE, FLOATING
	}

	public FlexiArea(TodoFile info) {
		this.todos = info;
		setTimeState(DEFAULT_TIME);
	}

	/*
	 * updates the dates one more time chunk
	 */
	public void nextTimeChunk() {
		switch (timeState) {
		case DAY:
			start = end;
			end = start.plus(Duration.ofDays(1));
			break;
		case WEEK:
			start = end;
			end = start.plus(Duration.ofDays(7));
			break;
		case MONTH:
			start = end;
			end = start.with(TemporalAdjusters.firstDayOfNextMonth());
			break;
		case FUTURE:
			start = LocalDate.now().atStartOfDay();
			break;
		case FLOATING:
			break;
		case ALL:
			break;
		}
	}

	public void previousTimeChunk() {
		switch (timeState) {
		case DAY:
			end = start;
			start = end.minus(Duration.ofDays(1));
			break;
		case WEEK:
			end = start;
			start = end.minus(Duration.ofDays(7));
			break;
		case MONTH:
			end = start;
			start = end.minus(Duration.ofDays(1)).with(TemporalAdjusters.firstDayOfMonth());
			break;
		case FUTURE:
			start = LocalDate.now().atStartOfDay();
			break;
		case FLOATING:
			break;
		case ALL:
			break;
		}
	}

	public void setTimeState(TimeState timeState) {
		checkTimePreConditions();
		switch (timeState) {
		case DAY:
			end = start.plus(Duration.ofDays(1));
			break;
		case WEEK:
			start = start.with(WeekFields.of(Locale.getDefault()).dayOfWeek(), 1);
			end = start.plus(Duration.ofDays(7));
			break;
		case MONTH:
			start = start.with(TemporalAdjusters.firstDayOfMonth());
			end = start.with(TemporalAdjusters.firstDayOfNextMonth());
			break;
		case ALL:
			start = LocalDateTime.MIN;
			end = LocalDateTime.MAX;
			break;
		case FUTURE:
			start = LocalDate.now().atStartOfDay();
			end = LocalDateTime.MAX;
			break;
		case FLOATING:
			break;
		}
		this.timeState = timeState;
		refresh();
	}

	private void checkTimePreConditions() {
		if (start == null) {
			start = LocalDate.now().atStartOfDay();
		}
		if (end == null) {
			end = LocalDate.now().atStartOfDay();
		}
		if (start.getYear() == -999999999) {
			start = LocalDate.now().atStartOfDay();
		}
	}

	public void refresh() {
		setMode(mode);
	}

	private List<GuiTodo> toGuiTodos(List<TodoItem> todos, GuiTodo.SoD status) {
		List<GuiTodo> ret = new ArrayList<GuiTodo>();
		for (TodoItem todo : todos) {
			ret.add(new GuiTodo(todo, status));
		}
		return ret;
	}

	public void setMode(Mode newState) {
		this.getChildren().clear();
		if (timeState == TimeState.FLOATING) {
			sortForFloating(newState);
		} else {
			sortForOther(newState);
		}
		if (doneLast) {
			Collections.sort(currTodos, GuiTodo.getStatusComparator());
		}
		printGuiTodos(currTodos);
		if (timeState == TimeState.DAY || timeState == TimeState.WEEK || timeState == TimeState.MONTH) {
			println("Ending " + end + "\n");
		}
		this.mode = newState;
	}

	private void sortForOther(Mode newState) {
		if (timeState != TimeState.ALL) {
			println("Starting " + start + "\n");
		}
		List<GuiTodo> startTodos = toGuiTodos(todos.filterStartDates(start, end), GuiTodo.SoD.START);
		List<GuiTodo> dueTodos = toGuiTodos(todos.filterDueDates(start, end), GuiTodo.SoD.DUE);

		switch (newState) {
		case SORT_PRIORITY:
			Collections.sort(startTodos, GuiTodo.getPriorityComparator());
			Collections.sort(dueTodos, GuiTodo.getPriorityComparator());
			break;
		case SORT_CONTENTS:
			Collections.sort(startTodos, GuiTodo.getContentsComparator());
			Collections.sort(dueTodos, GuiTodo.getContentsComparator());
			break;
		case SORT_START_DATE:
		case SORT_DUE_DATE:
			Collections.sort(startTodos, GuiTodo.getStartDateComparator());
			Collections.sort(dueTodos, GuiTodo.getDueDateComparator());
			break;
		case SORT_STATUS:
			break;
		}
		currTodos = new ArrayList<GuiTodo>();
		currTodos.addAll(dueTodos);
		currTodos.addAll(startTodos);
	}

	private void sortForFloating(Mode newState) {
		currTodos = toGuiTodos(todos.filterFloatingTodos(), GuiTodo.SoD.FLOATING);
		switch (newState) {
		case SORT_PRIORITY:
			Collections.sort(currTodos, GuiTodo.getPriorityComparator());
			break;
		case SORT_CONTENTS:
			Collections.sort(currTodos, GuiTodo.getContentsComparator());
			break;
		case SORT_START_DATE:
		case SORT_DUE_DATE:
			break;
		case SORT_STATUS:
			Collections.sort(currTodos, GuiTodo.getStatusComparator());
			break;
		}
	}

	public void printGuiTodos(List<GuiTodo> todos) {
		int i = 1;
		for (GuiTodo t : todos) {
			printTodo(i, t);
			i++;
		}
	}

	private void printTodo(int i, GuiTodo t) {
		Text txt;
		TodoItem todo = t.getTodo();
		if (t.getStatus() == GuiTodo.SoD.FLOATING) {
			txt = printFloating(i, todo);
		} else {
			txt = printOther(i, t, todo);
		}
		this.getChildren().add(txt);
	}

	private Text printOther(int i, GuiTodo t, TodoItem todo) {
		Text txt;
		String ret = leftPad(i + ". ", 6) + todo.getStatus().name() + ", " + leftPad(t.getStatus().name(), 5)
				+ " date at "
				+ (t.getStatus() == GuiTodo.SoD.DUE ? todo.getDueDate() : todo.getStartDate());
		txt = new Text(leftPad(ret, padSize) + " || " + todo.getContents() + "\n");
		txt.setFont(Font.font("monospaced"));
		if (todo.isDone()) {
			txt.setFill(Color.BLUE);
		} else {
			if (todo.getDueDate() != null && Instant.now().isAfter(todo.getDueDate().toInstant())) {
				txt.setFill(Color.RED);
			} else {
				txt.setFill(Color.GREEN);
			}
		}
		return txt;
	}

	private Text printFloating(int i, TodoItem todo) {
		Text txt;
		String ret = leftPad(i + ". ", 6) + todo.getStatus().name();
		txt = new Text(ret + " || " + todo.getContents() + "\n");
		txt.setFont(Font.font("monospaced"));
		if (todo.isDone()) {
			txt.setFill(Color.BLUE);
		} else {
			txt.setFill(Color.GREEN);
		}
		return txt;
	}

	private static String leftPad(String s, int pad) {
		if (s.length() < pad) {
			return s.concat(repeat(pad - s.length()));
		}
		return s;
	}

	private static String repeat(int count, String with) {
		return new String(new char[count]).replace("\0", with);
	}

	private static String repeat(int count) {
		return repeat(count, " ");
	}

	public void println(String s) {
		this.getChildren().add(new Text(s));
	}

	public Mode getMode() {
		return mode;
	}

	public String startString() {
		return start.toString();
	}

	public String endString() {
		return end.toString();
	}

	public TimeState getTimeState() {
		return timeState;
	}

	public void powerSearchString(String trim) {
		todos.powerSearchString(trim);
	}

	public void searchDate(Date parsedSearchDate) {
		todos.searchDate(parsedSearchDate);

	}

	public void searchPriority(int prty) {
		todos.searchPriority(prty);
	}

	public void findFreeTime() {
		todos.findFreeTime();

	}

	public void findOverlap() {
		todos.findOverlap();
	}

	public void setTodos(TodoFile todos) {
		this.todos = todos;
		refresh();
	}

	public boolean isDoneLast() {
		return doneLast;
	}

	public void toggleDoneLast() {
		this.doneLast = !this.doneLast;
		refresh();
	}

	public TodoItem getTodoItem(int i) {
		return currTodos.get(i).getTodo();
	}

	public void searchInTimeBlock(Date searchBlkStartDate, Date searchBlkEndDate) {
		todos.searchInTimeBlock(searchBlkStartDate, searchBlkEndDate);
	}
}
```
###### \view\FlexiAreaTest.java
``` java
 */
public class FlexiAreaTest {
	private FlexiArea flexiArea;
	private TodoFile todoFile;

	/**
	 * @throws java.lang.Exception
	 */
	@Before
	public void setUp() throws Exception {
		todoFile = new TodoFile("test.arst");
		flexiArea = new FlexiArea(todoFile);
	}

	/**
	 * Test method for {@link view.FlexiArea#FlexiArea()}.
	 */
	@Test
	public void testFlexiArea() {
		assertEquals(flexiArea.getTimeState(), FlexiArea.DEFAULT_TIME);
		assertEquals(flexiArea.getMode(), FlexiArea.DEFAULT_MODE);
	}

	/**
	 * Test method for {@link view.FlexiArea#setMode(view.FlexiArea.Mode)}.
	 */
	@Test
	public void testSetMode() {
		flexiArea.setTimeState(FlexiArea.TimeState.FLOATING);
		int start = flexiArea.getChildren().size();
		todoFile.add(1, "Hi there");
		flexiArea.setMode(FlexiArea.Mode.SORT_START_DATE);
		assertEquals(flexiArea.getMode(), FlexiArea.Mode.SORT_START_DATE);
		assertEquals(flexiArea.getChildren().size(), start + 1);
	}

	public List<GuiTodo> addStarts() {
		List<GuiTodo> starts = new ArrayList<GuiTodo>();
		starts.add(new GuiTodo(new TodoItem("Hi"), GuiTodo.SoD.START));
		starts.add(new GuiTodo(new TodoItem("There"), GuiTodo.SoD.START));
		starts.add(new GuiTodo(new TodoItem("All"), GuiTodo.SoD.START));
		return starts;
	}

	public List<GuiTodo> addDues() {
		List<GuiTodo> starts = new ArrayList<GuiTodo>();
		starts.add(new GuiTodo(new TodoItem("Hi"), GuiTodo.SoD.DUE));
		starts.add(new GuiTodo(new TodoItem("There"), GuiTodo.SoD.DUE));
		starts.add(new GuiTodo(new TodoItem("All"), GuiTodo.SoD.DUE));
		return starts;
	}

	/**
	 * Test method for {@link view.FlexiArea#printStartTodos(java.util.List)}.
	 */
	@Test
	public void testPrintStartTodos() {
		int s = flexiArea.getChildren().size();
		List<GuiTodo> starts = addStarts();
		flexiArea.printGuiTodos(starts);
		assertEquals(s + 3, flexiArea.getChildren().size());
		assertTrue(flexiArea.getChildren().get(s + 2) instanceof Text);
	}

	/**
	 * Test method for {@link view.FlexiArea#printDueTodos(java.util.List)}.
	 */
	@Test
	public void testPrintDueTodos() {
		List<GuiTodo> starts = addDues();
		int s = flexiArea.getChildren().size();
		flexiArea.printGuiTodos(starts);
		assertEquals(s + 3, flexiArea.getChildren().size());
		assertTrue(flexiArea.getChildren().get(s + 2) instanceof Text);
	}

	/**
	 * Test method for {@link view.FlexiArea#println(java.lang.String)}.
	 */
	@Test
	public void testPrintln() {
		int s = flexiArea.getChildren().size();
		flexiArea.println("Hi There");
		assertEquals(s + 1, flexiArea.getChildren().size());
		assertTrue(flexiArea.getChildren().get(s) instanceof Text);
		assertTrue(((Text) flexiArea.getChildren().get(s)).getText().equals("Hi There"));
	}

	/**
	 * Test method for {@link view.FlexiArea#printGuiTodos(java.util.List)}.
	 */
	@Test
	public void testPrintGuiTodos() {
		List<GuiTodo> starts = addStarts();
		starts.addAll(addDues());
		int s = flexiArea.getChildren().size();
		flexiArea.printGuiTodos(starts);
		assertEquals(s + 6, flexiArea.getChildren().size());
		assertTrue(flexiArea.getChildren().get(s + 2) instanceof Text);
	}

	/**
	 * Test method for {@link view.FlexiArea#getMode()}.
	 */
	@Test
	public void testGetMode() {
		assertEquals(flexiArea.getMode(), FlexiArea.DEFAULT_MODE);
	}

	/**
	 * Test method for {@link view.FlexiArea#getTimeState()}.
	 */
	@Test
	public void testGetTimeState() {
		assertEquals(flexiArea.getTimeState(), FlexiArea.DEFAULT_TIME);
	}

	/**
	 * Test method for {@link view.FlexiArea#setTodos(model.TodoFile)}.
	 */
	@Test
	public void testSetTodos() {
		List<GuiTodo> start = addStarts();
		flexiArea.printGuiTodos(start);
		int s = flexiArea.getChildren().size();
		flexiArea.setTodos(new TodoFile("arst.todo"));
		assertTrue(flexiArea.getChildren().size() != s);
	}

	/**
	 * Test method for {@link view.FlexiArea#toggleDoneLast()}.
	 */
	@Test
	public void testToggleDoneLast() {
		boolean prev = flexiArea.isDoneLast();
		flexiArea.toggleDoneLast();
		assertTrue(prev != flexiArea.isDoneLast());
	}
}
```
###### \view\GuiTodo.java
``` java
 */
import java.util.Comparator;

import model.TodoItem;

public class GuiTodo {
	public enum SoD {
		START, DUE, FLOATING
	};

	private SoD status;
	private TodoItem todo;

	public GuiTodo(TodoItem todo, SoD status) {
		this.todo = todo;
		this.status = status;
	}

	public SoD getStatus() {
		return status;
	}

	public TodoItem getTodo() {
		return todo;
	}

	public static Comparator<GuiTodo> getPriorityComparator() {
		return new Comparator<GuiTodo>() {
			public int compare(GuiTodo i, GuiTodo j) {
				return TodoItem.getPriorityComparator().compare(i.getTodo(), j.getTodo());
			}
		};
	}

	public static Comparator<GuiTodo> getContentsComparator() {
		return new Comparator<GuiTodo>() {
			public int compare(GuiTodo i, GuiTodo j) {
				return TodoItem.getContentsComparator().compare(i.getTodo(), j.getTodo());
			}
		};
	}

	public static Comparator<GuiTodo> getStatusComparator() {
		return new Comparator<GuiTodo>() {
			public int compare(GuiTodo i, GuiTodo j) {
				return TodoItem.getStatusComparator().compare(i.getTodo(), j.getTodo());
			}
		};
	}

	public static Comparator<GuiTodo> getStartDateComparator() {
		return new Comparator<GuiTodo>() {
			public int compare(GuiTodo i, GuiTodo j) {
				return TodoItem.getStartDateComparator().compare(i.getTodo(), j.getTodo());
			}
		};
	}

	public static Comparator<GuiTodo> getDueDateComparator() {
		return new Comparator<GuiTodo>() {
			public int compare(GuiTodo i, GuiTodo j) {
				return TodoItem.getDueDateComparator().compare(i.getTodo(), j.getTodo());
			}
		};
	}

}
```
###### \view\GuiTodoTest.java
``` java
 */
import static org.junit.Assert.*;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.junit.Before;
import org.junit.Test;

import model.TodoItem;

public class GuiTodoTest {
	List<GuiTodo> todos;

	@Before
	public void setUp() throws Exception {
		todos = new ArrayList<GuiTodo>();
		assert false;
	}

	public void addStandard() {
		todos.add(new GuiTodo(new TodoItem("hi"), GuiTodo.SoD.FLOATING));
		todos.add(
				new GuiTodo(new TodoItem(TodoItem.Status.DONE, -1, new Date(), null, "there", TodoItem.Frequency.NONE),
						GuiTodo.SoD.START));
		todos.add(new GuiTodo(new TodoItem(TodoItem.Status.TODO, -1, null, new Date(), "man", TodoItem.Frequency.NONE),
				GuiTodo.SoD.DUE));
	}

	@Test
	public void testNormal() {
		addStandard();
	}

	@Test
	public void testGetStatus() {
		addStandard();
		assertEquals(todos.get(0).getStatus(), GuiTodo.SoD.FLOATING);
		assertEquals(todos.get(1).getStatus(), GuiTodo.SoD.START);
		assertEquals(todos.get(2).getStatus(), GuiTodo.SoD.DUE);
	}

}
```
###### \view\TidyYard.java
``` java
 */
import java.io.PrintStream;

import controller.CommandInterpreter;
import javafx.application.Application;
import javafx.event.EventHandler;
import javafx.scene.Scene;
import javafx.scene.control.ScrollPane;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;
import javafx.scene.input.KeyCode;
import javafx.scene.input.KeyEvent;
import javafx.scene.layout.BorderPane;
import javafx.scene.paint.Color;
import javafx.stage.Stage;
import model.TodoFile;

public class TidyYard extends Application {
	private static final String DEFAULT_FILE = "main.todo";
	private CommandInterpreter controller;
	private TodoFile todos;
	private TextField inputField;
	private TextArea commandResult;
	private FlexiArea flexiView;
	private ScrollPane scroll;
	private BorderPane border;

	public static void main(String[] args) {
		launch(args);
	}

	private void addTopInput() {
		this.inputField = new TextField();
		this.inputField.setId("input");
		this.border.setTop(this.inputField);
	}

	private void addCommandResult() {
		this.commandResult = new TextArea();
		this.commandResult.setEditable(false);
		this.commandResult.setVisible(true);
		this.commandResult.setId("console");
		this.border.setBottom(this.commandResult);
	}

	private void addFlexiView() {
		this.flexiView = new FlexiArea(todos);
		this.flexiView.setVisible(true);
		this.flexiView.setId("flexi-view");
		this.scroll = new ScrollPane();
		this.scroll.setContent(this.flexiView);
		this.border.setCenter(this.scroll);
	}

	private void redirect() {
		PrintStream stream = new PrintStream(new ConsoleArea(commandResult), true);
		System.setOut(stream);
	}

	private void setScene(Stage primaryStage) {
		Scene scene = new Scene(border, 1000, 800, Color.BLACK);
		scene.setOnKeyPressed(new EventHandler<KeyEvent>() {
			@Override
			public void handle(KeyEvent e) {
				if (e.getCode().equals(KeyCode.ENTER)) {
					controller.nextCommand(inputField.getText());
					controller.executeCommand();
					inputField.clear();
				}
			}
		});
		primaryStage.setTitle("Tidy Yard");
		primaryStage.setScene(scene);
		primaryStage.show();
		redirect();
	}

	@Override
	public void start(Stage primaryStage) throws Exception {
		border = new BorderPane();
		addTopInput();
		addCommandResult();
		todos = new TodoFile(DEFAULT_FILE);
		addFlexiView();
		controller = new CommandInterpreter(todos, scroll);

		setScene(primaryStage);
	}

	@Override
	public void stop() {
		controller.exit();
	}
}
```
